<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Purificadora REM</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, sans-serif;
        background: #f2f4f7;
        display: flex;
    }

    /* =========== SIDEBAR =========== */
    .sidebar {
        width: 260px;
        height: 100vh;
        background: #1E1F26;
        color: white;
        display: flex;
        flex-direction: column;
        padding-top: 20px;
        position: fixed;
        left: 0;
        top: 0;
        box-shadow: 3px 0 10px rgba(0,0,0,0.2);
        transition: transform .3s ease;
    }

    .sidebar h2 {
        text-align: center;
        margin-bottom: 30px;
        color: #00AEEF;
    }

    .btn-menu {
        padding: 15px 20px;
        margin: 5px 15px;
        background: #2A2B33;
        border-radius: 10px;
        cursor: pointer;
        transition: .2s;
        font-size: 16px;
    }

    .btn-menu:hover {
        background: #00AEEF;
        color: black;
    }

    /* Botón hamburguesa (solo móvil) */
    .menu-toggle {
        display: none;
        position: fixed;
        top: 15px;
        left: 15px;
        background: #1E1F26;
        padding: 10px 14px;
        border-radius: 8px;
        color: white;
        font-size: 22px;
        cursor: pointer;
        z-index: 1000;
    }

    /* =========== CONTENIDO =========== */
    .content {
        margin-left: 260px;
        padding: 25px;
        width: 100%;
        transition: margin-left .3s ease;
    }

    .card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }

    .title {
        font-size: 22px;
        margin-bottom: 10px;
        color: #333;
    }

    /* ===== RESPONSIVE ===== */
    @media(max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
        }
        .sidebar.show {
            transform: translateX(0);
        }
        .menu-toggle {
            display: block;
        }
        .content {
            margin-left: 0;
            padding-top: 60px;
        }
    }

</style>
</head>
<body>

<!-- Botón hamburguesa -->
<div class="menu-toggle" onclick="toggleMenu()">☰</div>

<!-- MENU -->
<div class="sidebar" id="sidebar">
    <h2>Purificadora REM</h2>

    <div class="btn-menu" onclick="loadSection('Dashboard')">Dashboard</div>
    <div class="btn-menu" onclick="loadSection('Empleados')">Empleados</div>
    <div class="btn-menu" onclick="loadSection('Productos')">Productos</div>
    <div class="btn-menu" onclick="loadSection('cortes')">Cortes de Venta</div>
    <div class="btn-menu" onclick="loadSection('Inventario')">Inventario</div>
    <div class="btn-menu" onclick="loadSection('Clientes')">Clientes</div>
    <div class="btn-menu" onclick="loadSection('Inmobiliario')">Inmobiliario</div>
</div>

<!-- CONTENIDO -->
<div class="content">
    <div id="view" class="card">
        <h1 class="title">Bienvenido</h1>
        <p>Selecciona una opción del menú.</p>
    </div>
</div>

<script>

function toggleMenu() {
    document.getElementById("sidebar").classList.toggle("show");
}

/* ================================
   FUNCION PARA CARGAR SECCIONES
================================ */
function loadSection(section) {
    if (section !== "Dashboard") {
        document.getElementById("view").innerHTML =
            <h1 class='title'>${section}</h1><p>En construcción...</p>;
        return;
    }

    loadDashboard();
}

/* ================================
           GITHUB JSON
================================ */

function getJsonUrl(year, month) {
    return https://raw.githubusercontent.com/purificadoraREM/mi_negocio_data/main/VentaGral/VentaGral_${year}_${month}.json;
}

/* ================================
           DASHBOARD
================================ */

let chart;

function loadDashboard() {
    document.getElementById("view").innerHTML = `
        <h1 class="title">Dashboard</h1>

        <div style="margin-bottom:20px;">
            <label>Desde:</label>
            <input type="date" id="desde">

            <label>Hasta:</label>
            <input type="date" id="hasta">

            <button onclick="loadPersonalizado()">Personalizado</button>
            <button onclick="loadHoy()">Hoy</button>
            <button onclick="loadMes()">Este Mes</button>
        </div>

        <canvas id="grafica" height="120"></canvas>
    `;
}

/* ---- Cargar datos desde GitHub ---- */
async function loadJson(year, month) {
    const url = getJsonUrl(year, month);

    try {
        const res = await fetch(url);
        if (!res.ok) return [];
        return await res.json();
    } catch {
        return [];
    }
}

/* ---- HOY ---- */
async function loadHoy() {
    const hoy = new Date();
    const y = hoy.getFullYear();
    const m = String(hoy.getMonth() + 1).padStart(2, "0");
    const d = String(hoy.getDate()).padStart(2, "0");

    const data = await loadJson(y, m);
    const ventasHoy = data.filter(x => x.Fecha === ${y}-${m}-${d});

    const agrupado = {};

    ventasHoy.forEach(v => {
        const hora = v.Hora.substring(0,2) + ":00";
        agrupado[hora] = (agrupado[hora] || 0) + v.Total;
    });

    drawChart(Object.keys(agrupado), Object.values(agrupado), "Ventas por Hora (Hoy)");
}

/* ---- ESTE MES ---- */
async function loadMes() {
    const ahora = new Date();
    const y = ahora.getFullYear();
    const m = String(ahora.getMonth()+1).padStart(2,"0");

    const data = await loadJson(y,m);

    const agrupado = {};

    data.forEach(v => {
        const dia = v.Fecha.substring(8,10);
        agrupado[dia] = (agrupado[dia] || 0) + v.Total;
    });

    drawChart(Object.keys(agrupado), Object.values(agrupado), "Venta por Día (Mes Actual)");
}

/* ---- PERSONALIZADO ---- */
async function loadPersonalizado() {
    const desde = document.getElementById("desde").value;
    const hasta = document.getElementById("hasta").value;

    if (!desde || !hasta) {
        alert("Selecciona un rango de fechas");
        return;
    }

    let fi = new Date(desde);
    let ff = new Date(hasta);

    const resultados = {};

    while (fi <= ff) {
        const y = fi.getFullYear();
        const m = String(fi.getMonth()+1).padStart(2,"0");
        const d = String(fi.getDate()).padStart(2,"0");

        const data = await loadJson(y,m);

        data.filter(x => x.Fecha === ${y}-${m}-${d}).forEach(v => {
            resultados[d] = (resultados[d] || 0) + v.Total;
        });

        fi.setDate(fi.getDate()+1);
    }

    drawChart(Object.keys(resultados), Object.values(resultados), "Personalizado");
}

/* ---- GRAFICAR ---- */
function drawChart(labels, values, title) {
    const ctx = document.getElementById("grafica");

    if (chart) chart.destroy();

    chart = new Chart(ctx, {
        type: "bar",
        data: {
            labels,
            datasets: [{
                label: title,
                data: values
            }]
        }
    });
}

</script>

</body>
</html>
